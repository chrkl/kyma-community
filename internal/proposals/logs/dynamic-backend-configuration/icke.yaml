
kind: LogPipeline
metadata:
  name: logging-loki
spec:
    filters:
        - content: |
            Name               modify
            Match              loki.*
            Add                 icke    test
    outputs:
        - content: |
            Name               grafana-loki
            Alias              loki-output
            Match              loki.*
            Url                ${LOKI_ENDPOINT} # Defined in loki-credentials Secret
            LabelMapPath       /files/labelmap.json
    files:
        - name: labelmap.json
          content: |
          {
              "kubernetes": {
                "namespace_name": "namespace",
                "pod_name": "pod"
              },
              "stream": "stream"
          }
    secretRefs:
    - name: loki-credentials
      namespace: default
---
kind: TracePipeline
metadata:
  name: tracing-zipkin
spec:
    processors:
      attributes/meta:
        actions:
        - key: environment
            value: production
            action: insert
    exporters:
      zipkin/bla:
        endpoint: http://zipkin.istio-system.svc.cluster.local:9411/api/v2/spans
        insecure: true
    secretRefs:
    - name: zipkin-credentials
      namespace: default
---
kind: LogPreset
apiVersion: telemetry.kyma-project.io/v1alpha1
metadata:
  name: CLS-logging
spec:
    filters:
        - content: |
            Name               modify
            Match              loki.*
            Add                 icke    test
    outputs:
        - content: |
            Name               grafana-loki
            Alias              loki-output
            Match              loki.*
            Url                ${LOKI_ENDPOINT} # Defined in loki-credentials Secret
            LabelMapPath       /files/labelmap.json
    files:
        - name: labelmap.json
          content: |
          {
              "kubernetes": {
                "namespace_name": "namespace",
                "pod_name": "pod"
              },
              "stream": "stream"
          }
    placeholders:
      - name: LOKI_ENDPOINT
        description: endpoint URL
---
kind: PresetBinding
apiVersion: telemetry.kyma-project.io/v1alpha1
metadata:
  name: CLS-logging
spec:
    preset: CLS-logging
    secretRef: mySecret

    additionalFilters: {} # do we need it, will it imply dedicated LogPresetBinding?

    bindings: # should not be optional
      - placeholder: LOKI_ENDPOINT
        key: url
